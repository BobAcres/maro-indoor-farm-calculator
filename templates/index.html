<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Maro – Indoor Farm Calculator</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>

  <body>
    <div class="app-card">
      <!-- Header -->
      <header class="app-header">
        <div class="brand">
          <img
            src="{{ url_for('static', filename='palmtiny.png') }}"
            alt="Maro logo"
            class="brand-logo"
          />
          <div class="brand-text">
            <div class="brand-name">Maro</div>
            <div class="brand-tagline">Indoor Farm Calculator</div>
          </div>
        </div>
        <div class="brand-meta">
          <span class="meta-pill">Controlled Environment Agriculture</span>
        </div>
      </header>

      <!-- Form body -->
      <div class="form-body">
        {% if error %}
        <div class="error">{{ error }}</div>
        {% endif %}

        <form method="POST" action="{{ url_for('calculate') }}">
          <!-- LOCATION -->
          <section>
            <label>
              Country
              <select name="country" required>
                <option value="">Select country</option>
                {% for c in countries %}
                <option value="{{ c.code }}">{{ c.name }}</option>
                {% endfor %}
              </select>
            </label>
          </section>

          <!-- FARM SETUP -->
          <section>
            <label>
              Greenhouse area (m²)
              <input
                type="number"
                name="area_m2"
                step="1"
                min="1"
                required
                class="short-input"
              />
            </label>

            <label>
              Farm system type
              <select name="system_type" required class="short-input">
                {% for value, label in system_types %}
                <option value="{{ value }}">{{ label }}</option>
                {% endfor %}
              </select>
            </label>

            <label>
              Crop selection
              <select name="crop" required class="short-input">
                {% for value, label in crops %}
                <option value="{{ value }}">{{ label }}</option>
                {% endfor %}
              </select>
            </label>
          </section>

          <!-- OPTIONS -->
          <section>
            <h2 class="section-title">Options</h2>

            <div class="checkbox-grid">
              <label class="checkbox-item">
                <input type="checkbox" name="use_solar" />
                <span>Use solar</span>
              </label>

              <label class="checkbox-item">
                <input type="checkbox" id="use_custom_production_cost" />
                <span>Edit annual production cost</span>
              </label>

              <label class="checkbox-item">
                <input type="checkbox" id="use_custom_price" />
                <span>Edit selling price</span>
              </label>
            </div>
          </section>

          <!-- OPTIONAL INPUTS -->
          <section>
            <div id="production_cost_block" style="display: none">
              <label>
                Annual production cost
                <input
                  type="number"
                  name="annual_production_cost"
                  step="0.01"
                />
              </label>
            </div>

            <div id="price_block" style="display: none">
              <label>
                Selling price per kg
                <input type="number" name="price_per_unit" step="0.01" />
              </label>
            </div>
          </section>

          <div style="margin-top: 14px; text-align: center">
            <button type="submit" id="calcBtn">Calculate</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Toggle optional fields -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        function bindToggle(checkboxId, blockId) {
          const cb = document.getElementById(checkboxId);
          const block = document.getElementById(blockId);
          if (!cb || !block) return;

          function update() {
            block.style.display = cb.checked ? "block" : "none";
          }

          cb.addEventListener("change", update);
          update();
        }

        bindToggle("use_custom_production_cost", "production_cost_block");
        bindToggle("use_custom_price", "price_block");
      });
    </script>
  </body>
</html>
