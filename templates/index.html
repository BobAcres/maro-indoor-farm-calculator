<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Maro – Indoor Farm Calculator</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <div class="app-card">
      <!-- Header -->
      <header class="app-header">
        <div class="brand">
          <img
            src="{{ url_for('static', filename='palmtiny.png') }}"
            alt="Maro logo"
            class="brand-logo"
          />
          <div class="brand-text">
            <div class="brand-name">Maro</div>
            <div class="brand-tagline">Indoor Farm Calculator</div>
          </div>
        </div>
        <div class="brand-meta">
          <span class="meta-pill">Controlled Environment Agriculture</span>
        </div>
      </header>

      <!-- Form body -->
      <div class="form-body">
        {% if error %}
        <div class="error">{{ error }}</div>
        {% endif %}

        <form method="POST" action="{{ url_for('calculate') }}">
          {{ form.hidden_tag() }}

          <!-- LOCATION & CURRENCY -->
          <section>
            <label> Country {{ form.country() }} </label>

            <label>
              Currency override (optional, e.g. USD, CAD, NGN) {{
              form.currency_override( placeholder="Leave blank to use country's
              currency", class="short-input", maxlength="10" ) }}
            </label>
          </section>

          <!-- GREENHOUSE & CROP -->
          <section>
            <label>
              Greenhouse area (m²) {{ form.area_m2(step="1",
              class="short-input") }}
            </label>

            <label>
              Greenhouse level (technology) {{ form.setup_level() }}
            </label>

            <label>
              Farm system type {{ form.system_type(class="short-input") }}
            </label>

            <label> Crop selection {{ form.crop(class="short-input") }} </label>
          </section>

          <!-- OPTIONS -->
          <section>
            <h2 class="section-title">Options</h2>

            <div class="checkbox-grid">
              <label class="checkbox-item">
                <input type="checkbox" id="use_custom_production_cost" />
                <span>Edit annual production cost</span>
              </label>

              <label class="checkbox-item">
                {{ form.use_solar() }}
                <span>Use solar</span>
              </label>

              <label class="checkbox-item">
                <input type="checkbox" id="use_custom_price" />
                <span>Edit selling price</span>
              </label>

              <label class="checkbox-item">
                <input type="checkbox" id="use_custom_capex" />
                <span>Edit setup cost per m²</span>
              </label>
            </div>
          </section>

          <!-- PRODUCTION COST & PRICE -->
          <section>
            <div id="production_cost_block" style="display: none">
              <label>
                Total annual production cost {{
                form.annual_production_cost(step="0.01") }}
              </label>
            </div>

            <div id="price_block" style="display: none">
              <label>
                Selling price per unit (kg) {{ form.price_per_unit(step="0.01")
                }}
              </label>
            </div>
          </section>

          <!-- SETUP COST -->
          <section>
            <div id="capex_block" style="display: none">
              <label>
                Setup cost per m² {{ form.capex_per_m2(step="1") }}
              </label>
            </div>
          </section>

          <div style="margin-top: 14px; text-align: center">
            {{ form.submit(id="calcBtn") }}
          </div>
        </form>
      </div>
    </div>

    <!-- Show / hide optional fields -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        function bindToggle(checkboxId, blockId) {
          const cb = document.getElementById(checkboxId);
          const block = document.getElementById(blockId);
          if (!cb || !block) return;
          function update() {
            block.style.display = cb.checked ? "block" : "none";
          }
          cb.addEventListener("change", update);
          update();
        }

        bindToggle("use_custom_production_cost", "production_cost_block");
        bindToggle("use_custom_price", "price_block");
        bindToggle("use_custom_capex", "capex_block");
      });
    </script>
  </body>
</html>
